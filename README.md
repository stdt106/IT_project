# IT_project
News site with AI intergation

![Снимок экрана 2025-05-20 131447](https://github.com/user-attachments/assets/dbf693af-692c-449b-b083-ed9c61f4f30a)


# Сборщик Новостей

## Введение

В современном цифровом мире пользователи испытывают трудности в отслеживании и анализе информационного потока. Проект **«Сборщик Новостей»** направлен на решение этой проблемы путем автоматизации сбора, обработки и визуализации новостей с различных источников.

---

## Описание задачи

Цель проекта — создать систему, способную:
- собирать новости из нескольких RSS-источников;
- обрабатывать их с помощью модели GPT (DeepSeek) для генерации заголовков и кратких аннотаций;
- сохранять в базу данных (SQLite);
- предоставлять веб-интерфейс для просмотра и комментирования новостей через Django.

---

## Архитектура проекта

Проект состоит из двух компонентов:

### FastAPI
- Сбор новостей с сайтов `Lenta.ru` и `TASS` через RSS.
- Генерация заголовков и кратких описаний с помощью **DeepSeek GPT**.
- Сохранение в `JSON` файлы.
- Отправка новостей в очередь RabbitMQ.

### Django
- Прием новостей из очереди RabbitMQ.
- Сохранение в базу данных SQLite.
- Веб-интерфейс для пользователей: список новостей, детали, комментарии, авторизация.

### Взаимодействие через RabbitMQ

FastAPI → RabbitMQ → Django

---

## Асинхронность и синхронность

### Асинхронный FastAPI

FastAPI реализует асинхронную архитектуру:
- `@asynccontextmanager` → запуск `lifespan`.
- `background_loop` запускает парсеры каждые 15 секунд.
- `watchdog` следит за `neww.json` и `neww_tass.json`.

> DeepSeek API вызывается синхронно (через `requests`), но встроен в асинхронный цикл.

### Синхронный Django

Django реализует:
- прием новостей через `RabbitConsumer`;
- сохранение в SQLite;
- отображение новостей и комментариев через HTML-шаблоны.

---

## Брокер сообщений — RabbitMQ

RabbitMQ обеспечивает:
- буфер между FastAPI и Django;
- гарантированную доставку;
- масштабируемость за счет очередей (`news_queue`).

FastAPI:
```python
producer.send("news_queue", {
  "title": "Заголовок",
  "anons": "Краткое содержание",
  "full_text": "Полный текст",
  "data": ""
})
```
Django:

```python
def callback(ch, method, properties, body):
    data = json.loads(body)
    NewsItem.objects.create(**data)
    ch.basic_ack(delivery_tag=method.delivery_tag)
```

## База данных
Используется SQLite. Таблицы:
news: заголовок, аннотация, полный текст, источник, дата.
comments: комментарии к новостям.
users: учетные записи.

## Алгоритм работы
FastAPI каждые 15 секунд запускает run_lenta_parser() и run_tass_parser().
Парсер извлекает ссылку из RSS и получает полный текст статьи.
Генерируется заголовок и аннотация через GPT.
Новость сохраняется в neww*.json, отправляется в RabbitMQ.
Django принимает сообщение и сохраняет в базу.
Пользователь может прочитать и прокомментировать новость.

## Проблемы и решения
| Проблема             | Решение                                                        |
| -------------------- | -------------------------------------------------------------- |
| RSS пустой           | Добавлен user-agent                                            |
| Пустой текст статьи  | Улучшен парсинг через BeautifulSoup                            |
| Повторы в очереди    | Проверка по `full_text`                                        |
| Ошибки GPT           | Обернуто в `try/except`                                        |
| CTRL+C не срабатывал | Запуск `watchdog` и `background_loop` через `asyncio` и потоки |

# Примеры кода
Фоновый запуск парсера в FastAPI:

```python
async def background_loop():
    while True:
        run_lenta_parser()
        run_tass_parser()
        await asyncio.sleep(15)
GPT-запрос в service.py:
```

```python
data = {
   "model": "deepseek-ai/DeepSeek-R1",
   "messages": [{"role": "user", "content": f"Вот новость: {txt}"}]
}
response = requests.post(url, headers=headers, json=data)
```

## Итог
Проект успешно реализует:

* автоматический сбор новостей;

* интеллектуальную обработку с GPT;

* отображение через Django;

* масштабируемую и модульную архитектуру.

* система легко расширяется новыми источниками и парсерами.
